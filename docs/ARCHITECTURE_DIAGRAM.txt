â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                   NSE STOCK PERFORMANCE TRACKER ARCHITECTURE                 â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              USER INTERFACE LAYER                            â”‚
â”‚                              (Streamlit Frontend)                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚
                                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          APPLICATION LAYER (app.py)                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ main()                                                                â”‚   â”‚
â”‚  â”‚  â”œâ”€ Initialize session state                                         â”‚   â”‚
â”‚  â”‚  â”œâ”€ Apply CSS styling                                                â”‚   â”‚
â”‚  â”‚  â”œâ”€ Render UI components                                             â”‚   â”‚
â”‚  â”‚  â”œâ”€ Handle user interactions                                         â”‚   â”‚
â”‚  â”‚  â””â”€ Orchestrate data flow                                            â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ render_stock_selection_sidebar()                                     â”‚   â”‚
â”‚  â”‚  â””â”€ Category selection UI                                            â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ handle_file_upload()                                                 â”‚   â”‚
â”‚  â”‚  â”œâ”€ File validation                                                  â”‚   â”‚
â”‚  â”‚  â”œâ”€ Exchange detection (.NS/.BO)                                     â”‚   â”‚
â”‚  â”‚  â””â”€ Save/load/delete lists                                           â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ fetch_stocks_data()                                                  â”‚   â”‚
â”‚  â”‚  â”œâ”€ >100 stocks â†’ Bulk mode (3 workers)                             â”‚   â”‚
â”‚  â”‚  â”œâ”€ 50-100 stocks â†’ Parallel mode (3 workers)                       â”‚   â”‚
â”‚  â”‚  â””â”€ <50 stocks â†’ Sequential mode                                    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚                    â”‚                    â”‚
                    â–¼                    â–¼                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   UI COMPONENTS      â”‚  â”‚   DATA FETCHERS      â”‚  â”‚   UTILITIES          â”‚
â”‚  (ui_components.py)  â”‚  â”‚  (data_fetchers.py)  â”‚  â”‚     (utils.py)       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ render_header()    â”‚  â”‚ â€¢ fetch_nse_csv_list â”‚  â”‚ â€¢ color_percentage() â”‚
â”‚ â€¢ render_indices()   â”‚  â”‚ â€¢ get_stock_perf()   â”‚  â”‚ â€¢ get_current_times()â”‚
â”‚ â€¢ render_ticker()    â”‚  â”‚ â€¢ get_index_perf()   â”‚  â”‚ â€¢ create_html_table()â”‚
â”‚ â€¢ render_banner()    â”‚  â”‚ â€¢ get_commodities()  â”‚  â”‚ â€¢ get_ticker_data()  â”‚
â”‚ â€¢ render_performers()â”‚  â”‚ â€¢ fetch_stocks_bulk()â”‚  â”‚ â€¢ format_time()      â”‚
â”‚ â€¢ render_pagination()â”‚  â”‚ â€¢ get_stock_list()   â”‚  â”‚                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚
                                      â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   EXTERNAL DATA SOURCES          â”‚
                    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
                    â”‚ â€¢ NSE CSV Archives (stock lists) â”‚
                    â”‚ â€¢ Yahoo Finance (prices, indices)â”‚
                    â”‚ â€¢ yfinance API (commodities)     â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚
                                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                            PERSISTENCE LAYER                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚   CACHE MANAGER              â”‚    â”‚   FILE MANAGER               â”‚      â”‚
â”‚  â”‚   (cache_manager.py)         â”‚    â”‚   (file_manager.py)          â”‚      â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤      â”‚
â”‚  â”‚ â€¢ save_to_cache()            â”‚    â”‚ â€¢ save_list_to_csv()         â”‚      â”‚
â”‚  â”‚ â€¢ load_from_cache()          â”‚    â”‚ â€¢ load_list_from_csv()       â”‚      â”‚
â”‚  â”‚ â€¢ save_bulk_cache()          â”‚    â”‚ â€¢ delete_list_csv()          â”‚      â”‚
â”‚  â”‚ â€¢ load_bulk_cache()          â”‚    â”‚ â€¢ load_all_saved_lists()     â”‚      â”‚
â”‚  â”‚ â€¢ clear_cache()              â”‚    â”‚ â€¢ ensure_saved_lists_dir()   â”‚      â”‚
â”‚  â”‚ â€¢ get_cache_stats()          â”‚    â”‚                              â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                â”‚                                    â”‚                        â”‚
â”‚                â–¼                                    â–¼                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚   cache/stocks_cache.pkl     â”‚    â”‚   saved_stock_lists/*.csv    â”‚      â”‚
â”‚  â”‚   (Pickle format, 6hr expiry)â”‚    â”‚   (User uploaded lists)      â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚
                                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          CONFIGURATION LAYER                                 â”‚
â”‚                              (config.py)                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ FALLBACK_NIFTY_50 (50 stocks)                                             â”‚
â”‚ â€¢ FALLBACK_NIFTY_NEXT_50 (38 stocks)                                        â”‚
â”‚ â€¢ FALLBACK_BSE_SENSEX (30 stocks)                                           â”‚
â”‚ â€¢ INDICES_ROW1 (8 major indices)                                            â”‚
â”‚ â€¢ INDICES_ROW2 (7 sectoral indices)                                         â”‚
â”‚ â€¢ COMMODITIES (Oil, Gold, Silver, BTC)                                      â”‚
â”‚ â€¢ CUSTOM_CSS (440+ lines of dark theme styling)                             â”‚
â”‚ â€¢ METRIC_CSS (metric component styling)                                     â”‚
â”‚ â€¢ ITEMS_PER_PAGE = 10                                                       â”‚
â”‚ â€¢ SAVED_LISTS_DIR = "saved_stock_lists"                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                              DATA FLOW SEQUENCE                              â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

[1] User Opens App
        â”‚
        â–¼
[2] app.py: main() initializes
        â”‚
        â”œâ”€â†’ Load session state (saved_lists, current_list_name)
        â”œâ”€â†’ Apply CUSTOM_CSS from config.py
        â””â”€â†’ Render UI components
                â”‚
                â”œâ”€â†’ ui_components.render_header()
                â”‚       â””â”€â†’ utils.get_current_times() â†’ IST/EDT
                â”‚       â””â”€â†’ data_fetchers.get_commodities_prices()
                â”‚
                â”œâ”€â†’ ui_components.render_gainer_loser_banner()
                â”‚       â””â”€â†’ data_fetchers.get_index_performance()
                â”‚
                â””â”€â†’ ui_components.render_live_ticker()
                        â””â”€â†’ utils.get_ticker_data() [60s cache]
                                â””â”€â†’ data_fetchers.get_stock_list('Nifty 50')
        â”‚
        â–¼
[3] User Selects Category (Nifty 50 / Next 50 / Custom / Upload)
        â”‚
        â–¼
[4] data_fetchers.get_stock_list(category)
        â”‚
        â”œâ”€â†’ Try: fetch_nse_csv_list() [24hr cache]
        â”‚       â”‚
        â”‚       â”œâ”€â†’ Set browser headers
        â”‚       â”œâ”€â†’ Warm-up: Visit nseindia.com
        â”‚       â”œâ”€â†’ Fetch CSV from archives
        â”‚       â”œâ”€â†’ Parse with pandas
        â”‚       â””â”€â†’ Validate (min 40 stocks)
        â”‚
        â””â”€â†’ Fallback: Use FALLBACK_NIFTY_50 from config.py
        â”‚
        â–¼
[5] ui_components.render_market_indices()
        â”‚
        â””â”€â†’ data_fetchers.get_index_performance() [5min cache]
                â””â”€â†’ yfinance.Ticker(symbol).info
        â”‚
        â–¼
[6] User Configures Options
        â”‚
        â”œâ”€â†’ Sort by: 3 Months % / 2 Months % / 1 Month % / 1 Week % / Stock Name
        â”œâ”€â†’ Order: Best to Worst / Worst to Best
        â”œâ”€â†’ Parallel fetching: ON/OFF
        â””â”€â†’ Use cache: ON/OFF
        â”‚
        â–¼
[7] app.py: fetch_stocks_data(selected_stocks, use_parallel, use_cache)
        â”‚
        â”œâ”€â†’ If num_stocks > 100:
        â”‚       â””â”€â†’ data_fetchers.fetch_stocks_bulk(max_workers=3)
        â”‚               â”‚
        â”‚               â”œâ”€â†’ cache_manager.load_bulk_cache(tickers)
        â”‚               â”‚       â””â”€â†’ Returns (cached_data, missing_tickers)
        â”‚               â”‚
        â”‚               â””â”€â†’ ThreadPoolExecutor (3 workers)
        â”‚                       â””â”€â†’ Fetch missing stocks in parallel
        â”‚
        â”œâ”€â†’ Elif use_parallel or num_stocks > 50:
        â”‚       â””â”€â†’ ThreadPoolExecutor (3 workers)
        â”‚               â””â”€â†’ data_fetchers.get_stock_performance() for each
        â”‚
        â””â”€â†’ Else (Sequential):
                â””â”€â†’ Loop: data_fetchers.get_stock_performance() one by one
        â”‚
        â–¼
[8] data_fetchers.get_stock_performance(ticker, use_cache)
        â”‚
        â”œâ”€â†’ Check cache: cache_manager.load_from_cache(ticker)
        â”‚       â””â”€â†’ If valid (< 6 hours old): Return cached data
        â”‚
        â”œâ”€â†’ Retry Logic (3 attempts):
        â”‚       â”‚
        â”‚       â”œâ”€â†’ Attempt 1: Fetch immediately
        â”‚       â”œâ”€â†’ Attempt 2: Wait 3s, retry
        â”‚       â””â”€â†’ Attempt 3: Wait 9s, retry
        â”‚
        â”œâ”€â†’ yfinance.Ticker(ticker).history(period='4mo')
        â”‚       â””â”€â†’ Get 4 months of historical data
        â”‚
        â”œâ”€â†’ Get semi-live current price:
        â”‚       â””â”€â†’ stock.info.get('currentPrice') or hist['Close'].iloc[-1]
        â”‚
        â”œâ”€â†’ Calculate historical prices:
        â”‚       â”œâ”€â†’ 1 Week: hist['Close'].iloc[-6] (5 trading days)
        â”‚       â”œâ”€â†’ 1 Month: get_price_by_days_back(30)
        â”‚       â”œâ”€â†’ 2 Months: get_price_by_days_back(60)
        â”‚       â””â”€â†’ 3 Months: get_price_by_days_back(90)
        â”‚
        â”œâ”€â†’ Calculate percentage changes:
        â”‚       â”œâ”€â†’ change_1w = ((current - price_1w) / price_1w) * 100
        â”‚       â”œâ”€â†’ change_1m = ((current - price_1m) / price_1m) * 100
        â”‚       â”œâ”€â†’ change_2m = ((current - price_2m) / price_2m) * 100
        â”‚       â””â”€â†’ change_3m = ((current - price_3m) / price_3m) * 100
        â”‚
        â”œâ”€â†’ Format result:
        â”‚       â””â”€â†’ {'Stock Name', 'Current Price', '1 Week %', '1 Month %', ...}
        â”‚
        â””â”€â†’ Save to cache: cache_manager.save_to_cache(ticker, result)
        â”‚
        â–¼
[9] app.py: Create DataFrame
        â”‚
        â”œâ”€â†’ pd.DataFrame(stocks_data)
        â”œâ”€â†’ Apply sorting (by selected column)
        â”œâ”€â†’ Add rank column (1, 2, 3, ...)
        â””â”€â†’ Paginate (10 items per page)
        â”‚
        â–¼
[10] app.py: Apply Search Filter (optional)
        â”‚
        â”œâ”€â†’ st.text_input("ğŸ” Search") captures query (>= 3 chars)
        â”œâ”€â†’ Filter df by case-insensitive substring on "Stock Name"
        â”œâ”€â†’ Update summary stats with filtered counts
        â””â”€â†’ Fetch 52-week snapshots for top matches (â‰¤5)
        â”‚
        â–¼
[11] utils.create_html_table(df_page)
        â”‚
        â”œâ”€â†’ Generate HTML table structure
        â”œâ”€â†’ Color-code percentage columns:
        â”‚       â”œâ”€â†’ Positive: Green (#00ff00)
        â”‚       â”œâ”€â†’ Negative: Red (#ff4444)
        â”‚       â””â”€â†’ Zero: White (#ffffff)
        â””â”€â†’ Return HTML string
        â”‚
        â–¼
[12] Display Results
        â”‚
        â”œâ”€â†’ st.markdown(html_table, unsafe_allow_html=True)
        â”œâ”€â†’ ui_components.render_pagination_controls()
        â”œâ”€â†’ ui_components.render_top_bottom_performers(df)
        â”‚       â””â”€â†’ Top 3 and Bottom 3 by 3 Months %
        â””â”€â†’ ui_components.render_averages(df)
                â””â”€â†’ 1-year performance of key indices


â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                           CACHING ARCHITECTURE                               â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          MULTI-LAYER CACHING                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Layer 1: Streamlit @st.cache_data
    â”‚
    â”œâ”€â†’ fetch_nse_csv_list() â†’ 24 hours
    â”œâ”€â†’ get_index_performance() â†’ 5 minutes
    â””â”€â†’ get_ticker_data() â†’ 60 seconds

Layer 2: Persistent Pickle Cache (cache_manager.py)
    â”‚
    â”œâ”€â†’ File: cache/stocks_cache.pkl
    â”œâ”€â†’ Format: Pickle (25x faster than JSON)
    â”œâ”€â†’ Expiry: 6 hours
    â””â”€â†’ Structure:
            {
                'stocks': {
                    'RELIANCE.NS': {
                        'data': {...},
                        'timestamp': datetime(...)
                    },
                    ...
                },
                'last_updated': datetime(...)
            }

Cache Operations:
    â”‚
    â”œâ”€â†’ Save Single: save_to_cache(ticker, data)
    â”œâ”€â†’ Load Single: load_from_cache(ticker)
    â”œâ”€â†’ Save Bulk: save_bulk_cache(stocks_data)
    â”œâ”€â†’ Load Bulk: load_bulk_cache(tickers)
    â”œâ”€â†’ Clear All: clear_cache()
    â””â”€â†’ Get Stats: get_cache_stats()


â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                        PARALLEL FETCHING STRATEGY                            â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Decision Tree:
    â”‚
    â”œâ”€â†’ num_stocks > 100?
    â”‚       â”‚
    â”‚       â””â”€â†’ YES: Bulk Mode
    â”‚               â”œâ”€â†’ Load bulk cache (instant)
    â”‚               â”œâ”€â†’ Fetch missing stocks
    â”‚               â”œâ”€â†’ ThreadPoolExecutor (3 workers)
    â”‚               â”œâ”€â†’ Save bulk cache
    â”‚               â””â”€â†’ Combine cached + fresh
    â”‚
    â”œâ”€â†’ use_parallel OR num_stocks > 50?
    â”‚       â”‚
    â”‚       â””â”€â†’ YES: Parallel Mode
    â”‚               â”œâ”€â†’ ThreadPoolExecutor (3 workers)
    â”‚               â”œâ”€â†’ Submit all tasks
    â”‚               â”œâ”€â†’ as_completed() iterator
    â”‚               â”œâ”€â†’ Progress bar
    â”‚               â””â”€â†’ Timeout: 30s per stock
    â”‚
    â””â”€â†’ ELSE: Sequential Mode
            â”œâ”€â†’ Loop through stocks
            â”œâ”€â†’ Fetch one by one
            â”œâ”€â†’ Progress bar
            â””â”€â†’ Slower but more reliable

Rate Limit Protection:
    â”‚
    â”œâ”€â†’ Retry Logic: 3 attempts
    â”œâ”€â†’ Exponential Backoff: 3s, 9s, 27s
    â”œâ”€â†’ Conservative Workers: 3 (not 10)
    â””â”€â†’ Timeout Handling: 30s per stock


â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                          FILE UPLOAD WORKFLOW                                â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

[1] User Uploads File (.txt or .csv)
        â”‚
        â–¼
[2] app.py: handle_file_upload()
        â”‚
        â”œâ”€â†’ Read file content
        â”œâ”€â†’ Parse lines (one symbol per line)
        â””â”€â†’ Validate symbols
        â”‚
        â–¼
[3] Exchange Detection
        â”‚
        â”œâ”€â†’ User selects: Auto-detect / NSE (.NS) / BSE (.BO)
        â”‚
        â”œâ”€â†’ Auto-detect:
        â”‚       â””â”€â†’ Check filename: 'bse' in name â†’ .BO, else â†’ .NS
        â”‚
        â””â”€â†’ Manual: Use selected suffix
        â”‚
        â–¼
[4] Symbol Normalization
        â”‚
        â”œâ”€â†’ If symbol has .NS or .BO: Keep as-is
        â””â”€â†’ Else: Append selected suffix
        â”‚
        â–¼
[5] User Names List
        â”‚
        â””â”€â†’ Default: filename without extension
        â”‚
        â–¼
[6] Save List
        â”‚
        â”œâ”€â†’ file_manager.save_list_to_csv(list_name, stocks)
        â”‚       â””â”€â†’ saved_stock_lists/{list_name}.csv
        â”‚
        â”œâ”€â†’ Update session_state.saved_lists
        â””â”€â†’ Set session_state.current_list_name
        â”‚
        â–¼
[7] Load Anytime
        â”‚
        â””â”€â†’ file_manager.load_all_saved_lists()
                â””â”€â†’ Display in sidebar with Load/Delete buttons


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                            END OF ARCHITECTURE DIAGRAM
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
